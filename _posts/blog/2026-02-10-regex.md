---
layout: post
title: Building a Regex Engine with a team of parallel Claudes
date: 2026-02-10
categories: machine_learning
---

Inspired by [Nicholas Carlini's C compiler agent team experiment](https://www.anthropic.com/engineering/building-c-compiler).

## TLDR:

I tasked two Opus 4.6 agents to build a regex engine, and then walked away, here is the [repo](https://github.com/kiankyars/regex).

Over ~1,300 Claude Code sessions (with ~1,260 rateâ€‘limited), the agent team wrote ~1700 lines of code, and now I have a working rust regex engine:

```bash
kian@Kian regex %   cargo run -- "a+b*" "xxaaabbbzz"                                                                                             
   Compiling regex-engine v0.1.0 (/Users/kian/Developer/regex)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.06s
     Running `target/debug/regex-engine 'a+b*' xxaaabbbzz`
MATCH:aaabbb
```

## Setup

This expirement required two seperate pieces:

1. A remote which the agents could commit two and build their work

2. A server for running the agents with a cloned remote (the original expirement uses docker containers, I do not)

3. A third directory called server-stuff which hosts the files which the original c compiler post does not provide, namely:
 - AGENT_PROMPT.md
 - launch_agents.sh
 - agent_loop.sh

The main contribution of this blog post is providing the above harnessing

## Workflow

I ran two agents in parallel with `screen` and a simple loop script.

1. Keep `regex/` and `server-stuff/` as sibling directories.
2. Set `REPO` in `agent_loop.sh` to the local regex path.
3. Set `PROMPT_PATH` in `agent_loop.sh` to `server-stuff/AGENT_PROMPT.md`.
4. Launch with:

```bash
./server-stuff/launch_agents.sh 2
```

Each agent loop does:

1. Clone the repo into `workspace-<agent_id>` next to `regex/`.
2. `git pull --rebase origin main`.
3. Run Claude with the shared prompt.
4. Append session output to per-agent log files.
5. Sleep briefly and repeat forever.

Coordination primitives in the repo:

- `current_tasks/` for lock files (task claiming)
- `notes/` for handoffs and caveats
- `PROGRESS.md` for shared status updates

## Appendix

### Code size

- Counted files: 6 (`.rs` + `.sh`)
- Total lines: 1,680
- Approx. code lines (non-blank, non-comment): 1,331
- Rust: 1,328 total / 1,091 code lines
- Shell: 352 total / 240 code lines

### Agent sessions

- Total logged sessions: 1,273
- Agent 1 sessions: 519
- Agent 2 sessions: 754
- Rate-limit-only sessions: 1,259
- Non-rate-limited sessions: 14

### Model usage snapshot

- Tokens: In 9.4k / Out 6.5k
