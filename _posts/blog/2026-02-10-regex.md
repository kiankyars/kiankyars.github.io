---
layout: post
title: Building a Regex Engine with a team of parallel Claudes
date: 2026-02-10
categories: machine_learning
---

Inspired by [Nicholas Carlini's C compiler agent team experiment](https://www.anthropic.com/engineering/building-c-compiler).

## TL;DR

I tasked two Opus 4.6 agents to build a regex engine, then walked away. Here is the [repo](https://github.com/kiankyars/regex).

Over 14 Claude Code sessions, the agent team wrote ~1700 lines of code, and now I have a working Rust regex engine:

```bash
kian@Kian regex %   cargo run -- "a+b*" "xxaaabbbzz"
   Compiling regex-engine v0.1.0 (/Users/kian/Developer/regex)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 1.06s
     Running `target/debug/regex-engine 'a+b*' xxaaabbbzz`
MATCH:aaabbb
```

## Setup

This experiment required three separate pieces:

1. A remote which the agents could push to and build their work

2. A server for running the agents with a cloned remote (the original experiment uses Docker containers; I do not)

3. A third directory called [server-stuff](https://github.com/kiankyars/regex/tree/main/server-stuff) that hosts files not provided by the original post, namely:

- AGENT_PROMPT.md
- launch_agents.sh
- agent_loop.sh

My main contribution is providing the above harnessing.

## Workflow

I ran two agents in parallel with `screen` and a simple loop script.

1. Keep `regex/` and `server-stuff/` as sibling directories.
2. Set `REPO` in `agent_loop.sh` to the local regex path.
3. Set `PROMPT_PATH` in `agent_loop.sh` to `server-stuff/AGENT_PROMPT.md`.
4. Launch with:

```bash
./server-stuff/launch_agents.sh 2
```

Each agent loop does:

1. Clone the repo into `workspace-<agent_id>` next to `regex/`.
2. `git pull --rebase origin main`.
3. Run Claude with the shared prompt.
4. Append session output to per-agent log files.
5. Sleep briefly and repeat forever.

Coordination primitives in the repo:

- `current_tasks/` for lock files (task claiming)
- `notes/` for handoffs and caveats
- `PROGRESS.md` for shared status updates

## Analysis

### Where the real work happened

The implementation progress came from a small number of successful sessions:

- bootstrap to 37/38 tests
- harness fix and edge tests to 54/54
- optimization and robustness to 69/69
- hardening and expanded coverage to 159/159

### Session count is not commit count

- some sessions produced lock-only commits
- some sessions produced multiple commits
- some sessions produced no commit

### Coordination

- The lock-file mechanism using `current_tasks/` was generally effective, but there were a few cases where [stale](https://github.com/kiankyars/regex/commit/f2a3da76bd10fde16744a39c3ed95eb06ab88c51) locks required cleanup.

### Two things that helped Opus

- using oracle-based testing against the Python `re` library
- preserving modular boundaries (parser → abstract syntax tree → compiler → virtual machine)

## Replication

If you would like to replicate these results, it suffices to:

```bash
git clone git@github.com:kiankyars/regex.git
mv regex/server-stuff .
chmod 700 server-stuff/launch_agents.sh server-stuff/agent_loop.sh
git checkout -f c592a0534e60db71795863a8e64598f3779afc86
./server-stuff/launch_agents.sh 2
```

The above assumes you have the Claude Code CLI installed on your machine, along with `screen` and a few other standard Linux packages.

## Future Work

Today I am building SQLite from scratch, but this time I'm going to use both Codex and Claude on the same project to see how heterogeneous agents interact with each other. I'm thinking of a lock TTL (time to live) and automatic stale-lock cleanup to prevent agents from being blocked by abandoned lock files in `current_tasks/`.

### Multi-agent

I'm thinking of having specialized agent roles as well. Here is what Carlini did:

> I tasked one agent with coalescing any duplicate code it found. I put another in charge of improving the performance of the compiler itself, and a third I made responsible for outputting efficient compiled code. I asked another agent to critique the design of the project from the perspective of a Rust developer, and make structural changes to the project to improve the overall code quality, and another to work on documentation.

## Appendix

### Code size

- Counted files: 6 (`.rs` + `.sh`)
- Total lines: 1,680
- Approx. code lines (non-blank, non-comment): 1,331
- Rust: 1,328 total / 1,091 code lines
- Shell: 352 total / 240 code lines

### Agent sessions

- Total logged sessions: 1,273
- Agent 1 sessions: 519
- Agent 2 sessions: 754
- Rate-limit-only sessions: 1,259
- Non-rate-limited sessions: 14

### Model usage snapshot

- Tokens: In 9.4k / Out 6.5k
- Used ~30% of my Claude Pro weekly limit

### Notes on the Anthropic approach

- For context, this is the initial [commit](https://github.com/anthropics/claudes-c-compiler/commit/d8cbbec87e0607e6c6aedd601b1ea9afba3c4e7b) on the Anthropic repo, and this is the first [page](https://github.com/anthropics/claudes-c-compiler/commits/main/?after=6f1b99acb2f4ec2414592136c2009fe7713deec3+3960) of commits.

## Citation

```bibtex
@misc{kyars2026regex,
  author = {Kian Kyars},
  title = {Building a Regex Engine with a team of parallel Claudes},
  year = {2026},
  month = feb,
  day = {10},
  howpublished = {\url{https://kiankyars.github.io/machine_learning/2026/02/10/regex.html}},
  note = {Blog post}
}
```
